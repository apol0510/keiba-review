---
import StarRating from './StarRating.astro';
import type { Review, ReviewWithSite } from '../lib/airtable';

interface Props {
  review: Review | ReviewWithSite;
  showSiteName?: boolean;
}

const { review, showSiteName = false } = Astro.props;

const formatDate = (dateString: string) => {
  const date = new Date(dateString);
  return date.toLocaleDateString('ja-JP', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
};

const hasSiteInfo = 'site_name' in review && 'site_slug' in review;
---

<div class="bg-white rounded-lg shadow-md p-4">
  <div class="flex items-start justify-between mb-2">
    <div>
      <StarRating rating={review.rating} size="sm" />
      <h4 class="font-bold text-gray-900 mt-1">{review.title}</h4>
    </div>
    <span class="text-sm text-gray-500">{formatDate(review.created_at)}</span>
  </div>

  {
    showSiteName && hasSiteInfo && (
      <a
        href={`/keiba-yosou/${(review as ReviewWithSite).site_slug}/`}
        class="text-sm text-blue-600 hover:underline mb-2 inline-block"
      >
        {(review as ReviewWithSite).site_name}
      </a>
    )
  }

  <p class="text-gray-700 text-sm leading-relaxed whitespace-pre-wrap">
    {review.content}
  </p>

  <div class="mt-3 text-sm text-gray-500">
    <span>by {review.user_name}</span>
  </div>
</div>
